# ПАСПОРТ ЗАДАЧИ

2. Анализ требований
 Подход к проектированию решений – комбинированный, наполнение форм и передача данных идет через бэкенд, а дизайн форм, фильтрация данных и сортировка происходит на фронте.

2.1 Краткая история операций по одной карте:

- Разработать ЭФ «История операций по карте» (дизайн,мокап,согл дизайна, документ по фронты)
 - Сервисы для фронта:
 - Запрос истории операций
 - Сортировка истории операций
 - Требования для интеграции:
 - Документация ALL\_about\_cards

2.2 Общая история операций по всем картам

 - Доработать ЭФ «История операций по всем картам» (дизайн,мокап,согл дизайна, документ по фронты)
 - Сервисы для фронта:
 - Запрос истории операций
 - Требования для интеграции:
 - Документация ALL\_about\_cards

2.3 Фильтрация операций по категориям

- Доработать ЭФ «История операций по всем картам» (дизайн,мокап,согл дизайна, документ по фронты)
 - Сервисы для фронта:
 - Фильтрация операций по категориям
 - Требования для интеграции:
 - Документация ALL\_about\_cards

2.4 Сортировка операций по дате, сумме

- Доработать ЭФ «История операций по всем картам» (дизайн,мокап,согл дизайна, документ по фронты)
 - Сервисы для фронта:
 - Фильтрация операций по категориям
 - Требования для интеграции:
 - Документация ALL\_about\_cards

# **Frontend\_** Истории операций по картам

**Цель:** документ описывает раздел «Истории операций по картам», и дополнительные формы, входящие в раздел.

## **История изменений**

| **Автор** | **Дата изменения** | **Версия изменений** | **Описание** | **Задача** |
| --- | --- | --- | --- | --- |
| Шевнин О.Н. | 21.10.2021  | 1.0 | Draft|Исходная версия документа | TASK-1 |

## **Ссылка на дизайн**

## **Общие требования к разделу**
По-умолчанию раздел должен быть доступен при наличии у клиента флага доступа flag\_cardlist == true. Иначе, раздел не отображается.

Раздел доступен всем клиентам ДБО. Раздел открывается сразу после входа в ДБО и является частью «Главного экрана».

### Макет раздела

![](RackMultipart20211028-4-1ptzo2m_html_a5cd0b3fb3c7f978.png)

![](RackMultipart20211028-4-1ptzo2m_html_1134de0ec6773003.png)

![](RackMultipart20211028-4-1ptzo2m_html_cd7f10223ea6b349.png)

## Блок &quot;Карты&quot;

Для отображения раздела Frontend инициирует вызов сервиса GET api/cards/list (без параметров|запрос не параметризован)

В случае если от сервиса получена ошибка или пустой ответ, отображается экран с ошибкой. Текст сообщения «Что-то пошло не так, но мы уже знаем о проблеме…»

В случае если получен успешный ответ, Frontend отображает форму с параметрами:


|     **Поле**                  |     **Описание**                                                                                                                                                                                                                                |
|---------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|     Блок с картами        |     Содержит экземпляры data/cards[] ответа сервиса GET api/cards/list     Действия:     1) Реквизиты                                                                                                                                       |
|     Элемент Карта         |                                                                                                                                                                                                                                             |
|     Иконка                |     Значение data/cards/cardDesign ответа   сервиса GET api/cards/list    Если значение не получено, отображается иконка по-умолчанию                                                                                                       |
|     Название карты        |     Значение data/cards/name    В поле отображается 100 символов. Если значение больше, то отображается   только часть текста и троеточие.    При наведение на такую строку полный текст должен отображаться во всплывающей   подсказке.    |
|     Платежная система     |     Значение  data/cards/paySystem                                                                                                                                                                                                          |
|     Номер карты           |     Значение data/cards/maskedNumber    Отображается в формате *XXXX, где XXXX - последние 4 цифры значения                                                                                                                                 |
|     Тип карты             |     Значение data/cards/cardtype    В случае если получено значение    ·        ‘debit’ отобразить текст «Дебетовая»    ·        ‘credit’ – отобразить текст «Кредитная»                                                                    |
|     Баланс                |     Значение data/cards/balance    По-умолчанию отображается зеленым цветом    В случае если значение отрицательное - отображается красным цветом                                                                                           |
|           Статус карты    |     Если получено значение data/cards/status:          ‘active’ - отобразить        значение “Активна”      ‘blocked’- отобразить        значение “Заблокирована”      ‘inactive’ -        отобразить значение “Требует активации”          |

Под каждой картой отображаются действия, доступные с картой:

| **Действие** | **Описание** |
| --- | --- |
| Реквизиты | tbdTODO |
| Тарифы | tbd |
| Заблокировать | tbd |
| История | История операций |
| История операций | см. Раздел История операцийЭлемент представлен ссылкой.По нажатию на ссылку появляется раскрывающийся вниз блокЗаголовок блока меняется в зависимости от раскрытия: &quot;Показать/Скрыть историю операций&quot; |

## **Блок** **«История операций»**

 Для отображения раздела Frontend инициирует вызов сервиса GET api/cards/history (cardnumber, begindate, enddate, NumberOfOps |)

В случае если от сервиса получена ошибка или пустой ответ, отображается экран с ошибкой. Текст сообщения «Что-то пошло не так, но мы уже знаем о проблеме…»

В случае если получен успешный ответ, Frontend отображает форму с параметрами:

| Поле                      | Описание                                                                                         |
|---------------------------|--------------------------------------------------------------------------------------------------|
| Блок                      | Содержит экземпляры cards/history ответа сервиса GET api/cards/history                           |
| Карты                     | Содержит значения cardnumber                                                                     |
| Операци                   | Содержит значения begindate и enddate Значение по умолчанию: 10 дней включительно с текущей даты |
| Категории                 | Содержит значения begindate и enddate Значение по умолчанию: 10 дней включительно с текущей даты |
| Тип Операции              | Содержит значения card_sign ('Debit , 'Credit')                                                  |
| Сортировка по дате, сумме | Содержит значения ORDER BY DATE (ASC , DESC), ORDER BY transaction_amount (ASC, DESC)            |
| Элемент Операция          |                                                                                                  |
| Лого продавца             | Содержит значения data/cards/mccLogo                                                             |
| Наименование продавца     | Содержит значения mcc                                                                            |
| Операция                  | Содержит значения transaction_date (time?), place,                                               |
| Сумма операции            | Содержит значения transaction_amount,                                                            |
| Валюта операции           | Содержит значения auth_currency                                                                  |

В истории операций отображаются доступные действия
|     Действие                         |     Описание                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|--------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|     История операций                 |     Элемент представлен ссылкой.     По нажатию на ссылку появляется раскрывающийся вниз блок.Заголовок блока   меняется в зависимости от раскрытия: “Показать/Скрыть историю операций”                                                                                                                                                                                                                                                           |
|     Карта / все карты                |     Элемент представлен кнопкой.     По нажатию на кнопку отображается информация по выбранной карте    По нажатию на уже выбранную карту – информация по ней перестает отображаться,   она становится неактивной (закрывается полупрозрачный прямоугльником)     При нажатии на кнопку «все карты» отображаются все операции по картам,   принадлежащим клиенту. Если диапазон дат не менялся то отображаются операции   за последние 10 дней    |
|     Операции за последние 10 дней    |     Элемент представлен ссылкой.    По нажатию на ссылку отображается календарь с возможностью выбрать период дат   для операций, первое выбранное число – начало периода, второе число – его   конец.                                                                                                                                                                                                                                            |
|     Категории операций               |     Элемент представлен в виде кнопок    По нажатию на кнопку с «названием» отображается только информация по этой   категории    По нажатию на «х» отображаются все категории кроме этой, а  также категория перестает отображаться                                                                                                                                                                                                              |
|     Все типы операций                |     Элемент представлен в виде выпадающего списка    Возможно выбрать не менее 1 элемента списка     В зависимости от выбора будут отображаться поступления или траты по картам,   либо траты и поступления                                                                                                                                                                                                                                       |
|     Сортировать по дате              |     Элемент представлен кнопкой    при нажатии на символ «треугольник» меняется положение его вершины. Если   вершина ближе к левому краю – результаты формируются по убыванию. Ближайшая к   верху экрана дата ближе всего к текущей дате или концу выбранного периода.     Если вершина справа – результат формируется по возрастанию, соответственно   ближайшая к верху экрана дата ближе к началу выбранного периода                         |
|     Сортировать по сумме             |     Элемент представлен кнопкой    при нажатии на символ «треугольник» меняется положение его вершины.    Если вершина ближе к левому краю – результаты формируются по убыванию –ближе   к верху экрана отображаются результаты от наибольшей сумма операции к   наименьшей    Если вершина справа – результаты формируются по возрастанию –ближе к верху   экрана отображаются результаты от наименьшей суммы операции к наибольшей              |

**API\_Получение\_Истории\_по\_операциям**

## **История изменений**

| **Автор** | **Версия изменений** | **Описание** | **Задача** |
| --- | --- | --- | --- |
| Шевнин О.Н. | 1.0 | Draft|Исходная версия документа | TASK-1 |

**Цель:** сервис предназначен для получения истории операций по картам клиента.

**URL:** [endpoint]/api/cards/history

**Метод** :**GET**

**Доступ:** авторизованная зона. Сервис вызывается с фронта.

**Входные параметры:** нет или (только активные)

|     Параметр      |     Тип поля     |     Описание                                                                                              |     Обязательность    |
|-------------------|------------------|-----------------------------------------------------------------------------------------------------------|-----------------------|
|     **cardnumber**    |     String       |     Виртуальный или полный номер карты. Может быть несколько неодинаковых в   запросе                     |     Нет               |
|     **сardid**        |        Number    |      ИД карты, используется как альтернатива   cardnumber. Может быть несколько неодинаковых в запросе    |     Нет               |

**Выходные параметры:**

| **Параметр** | **Тип поля** | **Описание** | **Обязательность** |
| --- | --- | --- | --- |
| data/cards | List[Object] | Список карт | Нет |
| data/cards/cardDesign | String | Дизайн карты (урл до картинки) | Нет |
| data/cards/history | List[Object] | Список операций по картам | Да |
| auth\_date | Date  | Дата операционного дня проведения расчетов по операции | Нет |
| description | String  | Назначение операции | Нет |
| authorization\_code | Number | Код авторизации. Код, присвоенный Участником, разрешившим совершение операции. | Нет |
| auth\_amount | Number | Сумма операции в валюте транзакции | Нет |
| auth\_currency | String | Валюта операции | Да |
| card\_sign | String | Знак операции, принимает значения &#39;Debit&#39; или &#39;Credit&#39; | Да |
| transaction\_amount | Number | Сумма операции в валюте карты | Да |
| transaction\_currency | String | Валюта карты  | Да |
| mcc | Number | Код идентифицирующий категорию (бизнес-код) точки сервиса | Да |
| place | String | Параметры пункта обслуживания (название и город).  | Да |
| oper\_type | String |  Тип операции, IBN - оплата услуг в ИБ, POS - POS, ATM - наличка, BAL - платный запрос баланса карты, P2P - P2P, KOM - комиссия, KAS - наличка, ACC - перевод по счету.   | Нет |
| OPERATIONSTATUS | String  | Статус операции | Нет |
| transaction\_date | DateTime | Дата операции | Да |

## Основной сценарий (MC)

1. Сервис проверяет входные параметры запроса:
 Если не указаны **enddate и begindate** то формируется ответ по формуле: **enddate**  **=** сегодняшняя дата минус 10 дней ( **begindate** )
2. Сервис выполняет поиск истории операций для выбранных карт в таблице history
3. Сервис инициирует получение всех операций по заданным параметрам
4. Сервис формирует ответ согласно маппингу:

| Параметр ответа | Правила формирования |
| --- | --- |
| data/cards/history/transaction\_currency | Значение ₽ если в transaction\_currency  получено значение &#39;RUB&#39;Значение &#39; **$**&#39; если в transaction\_currency  получено значение &#39;USD&#39;Значение &#39; **€**&#39; если в transaction\_currency  получено значение &#39;EUR&#39; |
| tbd | tbd |

5. Сервис возвращает ответ вызывающей системе
6. Вызывающая система передает данные во frontend
7. Frontend производит сортировку и фильтрацию данных в соответствии с действиями пользователя


## Исключительные сценарии (EC)

ЕС-1. У клиента нет истории операций

1. Сервис формирует ответ, согласно маппингу:

| **Параметр ответа** | **Правило формирования** |
| --- | --- |
| data/error/code | Код ошибки |
| data/error/text | &quot;У вас нет ни одной операции! Чтобы увидеть историю – совершите покупку...&quot; |

1. API возвращает ответ
2. Вызывающая система передает данные во frontend
3. Frontend производит сортировку и фильтрацию данных в соответствии с действиями пользователя

Уважаемые коллеги!
 В случае обнаружения недоработок – прошу связаться с автором. Помните что документ в состоянии Draft!

**В конце написать – с каким сложностями столкнулись при написании:**
 сначала было вообще непонятно что от меня требуется.
 Также было принято решение не разбивать задачу на кучу мелких чтобы у разработчика была вся картинка в голове, возможно после дейлика на обсуждении разбить на 2 части:
 1.история с сортировкой; 2.выбор перечня карт
 далее непонятно было что уже умеет система, какие у нее сейчас возможности, как ее нагрузит появление дополнительного запроса
