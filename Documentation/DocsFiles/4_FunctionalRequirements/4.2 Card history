# **API\_Просмотр истории операций по картам**
## История изменений

|**Автор**|**Версия изменений**|**Описание**|**Задача**|
| :--------: | :-: | :-: | :-: |
|Кахович О.А.|1.0|Исходная версия документа|AN\_DOC\_1|
**Цель:** сервис предназначен для получения истории операций по картам клиента.

**URL:** [endpoint]/api/cards/history

**Метод:** GET 

**Доступ:** авторизованная зона. Сервис вызывается с фронта.

**Входные параметры:**

|**Параметр**|Тип|Формат|**Описание**|**Обязательность**|
| :- | :- | :- | :- | :-: |
|cardnumber|string||Номер карты|да|
|beginhistory|string|yyyy-mm-dd|дата начала за который запрашивается информация|нет|
|endhistory|string|yyyy-mm-dd|дата окончания за который запрашивается информация|нет|
**Выходные параметры:**

|**Параметр**|**Тип поля**|**Описание**|**Обязательность**|
| :- | :-: | :- | :-: |
|data/cards/transactions|List[Object]|Список операций по карте |Нет|
|data/icons/merchDesign|String|Ссылка на Иконку мерчанта|Нет|
|data/icons/operDesign|String|Ссылка на Иконку операции|Нет|
|data/merchant/merchName|String|Наименование мерчанта|Нет|
|data/operations/operName|String|Наименование операции|Нет|
|data/transactions/currency|String|Валюта операции|Да|
|data/transactions/date|String|Дата и время совершения операции|Да|
|data/transactions/category|String|Категория операции|Нет|
|data/transactions/sum|Number|Сумма операции|Да|
## **Основной сценарий (MC)**
1. Сервис проверяет входные параметры запроса: 
   1. Если получен параметр beginhistory и/или endhistory, то переход к сценарию AC-1 - Получение истории за заданный период.
   2. Иначе, сценарий продолжается.
2. Сервис зпрашивает в АБС «Cards» 5 последних операций по указанной  карте 
3. Если в АБС «Сards» нет данных об истории операций, то переход к ЕС-1 - Нет операций по карте
4. Сервис сортирует данные по дате операции
5. Сервис формирует ответ согласно маппингу:

|**Параметр ответа**|**Правило формирования**|
| :- | :- |
|data/icons/merchDesign|уточнить где брать|
|data/icons/operDesign|уточнить где брать|
|data/merchant/merchName|Значение place запроса к АБС «Cards»|
|data/operations/operName|уточнить где брать|
|data/transactions/currency|Значение auth\_currency запроса к АБС «Cards»|
|data/transactions/date|Значение transaction\_date запроса к АБС «Cards»|
|data/transactions/category|Значение mcc запроса к АБС «Cards»|
|data/transactions/sum|Значение auth\_amount  запроса к АБС «Cards»|

6. Сервис возвращает ответ вызывающей системе (краткая история).
## **Альтернативный сценарий (AC)**
**АС-1. Получение истории за заданный период.**

1. Сервис инициирует запрос истории операций по карте за период, указанный в параметрах beginhistory и/или endhistory в АБС «Cards»

2. Сервис сортирует данные по дате операции

3. Сервис формирует ответ согласно маппингу:

|**Параметр ответа**|**Правило формирования**|
| :-| :-|
|data/icons/merchDesign|уточнить где брать|
|data/icons/operDesign|уточнить где брать|
|data/merchant/merchName|Значение place запроса к АБС «Cards»|
|data/operations/operName|уточнить где брать|
|data/transactions/currency|Значение auth\_currency запроса к АБС «Cards»|
|data/transactions/date|Значение transaction\_date запроса к АБС «Cards»|
|data/transactions/category|Значение mcc запроса к АБС «Cards»|
|data/transactions/sum|Значение auth\_amount  запроса к АБС «Cards»|

4. Если получен пустой ответ, ошибка или таймаут, то переход к сценарию ЕС-1

5. Сервис возвращает ответ вызывающей системе (полная история/история за период).

## **Исключительные сценарии (EC)**
**ЕС-1. Нет операций по карте** 

1. Сервис формирует ответ, согласно маппингу.

|**Параметр ответа**|**Правило формирования**|
| :- | :- |
|data/error/code|Код ошибки|
|data/error/text|тексты сообщений определяются на этапе системного анализа|






        
