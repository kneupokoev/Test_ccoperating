# 4.2 API_Получение истории операций

## История изменений
|Автор|Версия изменений|Описание|Задача|
|-----|----------------|--------|------|
|Пименова Т.В.|1.0|Исходная версия документа|TASK-1|

**Цель:** сервис предназначен для получения списка операций по карте.

**URL:** [endpoint]/api/card/operations

**Метод:** GET

**Доступ:** авторизованная зона. Сервис вызывается с фронта.

**Входные параметры:**

| Параметр    | Тип поля | Описание                                                                        | Обязательность |
|-------------|----------|---------------------------------------------------------------------------------|----------------|
| cardnumber  | String   | Виртуальный или полный номер карты                                              | да             |
| cardid3c    | Number   | ИД карты, используется как альтернатива cardnumber                              | да             |
| begindate   | String   | Дата начала периода, за который запрашивается информация (формат yyyy-mm-dd)    | да             |
| enddate     | String   | Дата окончания периода, за который запрашивается информация (формат yyyy-mm-dd) | да             |
| numberOfOps | Number   | Максимальное количество операций, которое нужно вернуть в ответ                 | нет            |

**Выходные параметры:**

| Параметр                  | Тип поля     | Описание                                                                                                                                                               | Обязательность |
|---------------------------|--------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------|
| data/operations[]         | List[Object] | Список операций по карте                                                                                                                                               | Нет            |
| data/operations/date      | String       | Дата совершения операции (в формате yyyy-mm-dd)                                                                                                                        | Да             |
| data/operations/sign      | String       | Знак операции, принимает значения 'Debit' или 'Credit'                                                                                                                 | Да             |
| data/operations/amount    | Number       | Сумма операции в валюте карты                                                                                                                                          | Да             |
| data/operations/currency  | String       | Валюта карты                                                                                                                                                           | Да             |
| data/operations/place     | String       | Название пункта обслуживания                                                                                                                                           | Да             |
| data/operations/icon      | String       | Иконка пункта обслуживания                                                                                                                                             | Да             |
| data/operations/oper_type | String       | Тип операции, IBN - оплата услуг в ИБ, POS - POS, ATM - наличка, BAL - платный запрос баланса карты, P2P - P2P, KOM - комиссия, KAS - наличка, ACC - перевод по счету. | Да             |
| data/operations/category  | String       | Категория операции                                                                                                                                                     | Да             |

## Основной сценарий (MC)

1. Сервис инициирует получение списка операций по карте из АБС Cards, формируя запрос:

|Атрибут|Описание|
|-------|--------|
|cardnumber|Виртуальный или полный номер карты|
|numberOfOps|Максимальное количество операций, которое нужно вернуть в ответ|
|enddate|Дата окончания периода, за который запрашивается информация (формат yyyy-mm-dd)|
|cardid3c| ИД карты, используется как альтернатива cardnumber|
|begindate|Дата начала периода, за который запрашивается информация (формат yyyy-mm-dd)|

2. После получения ответа от бэк-системы, выполняется проверка, получена ли информация об операциях:
    * Если получен пустой ответ, ошибка или таймаут, то переход к сценарию ЕС-1. Отсутствуют операции по карте
3. Сервис сортирует операции в порядке от новых к старым.
4. Сервис формирует ответ согласно маппингу:
   
| Параметр ответа           | Правило формирования                                                                                                                                                                                                   |
|---------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| data/operations           | -                                                                                                                                                                                                                      |
| data/operations/date      | Значение card_operations.date                                                                                                                                                                                          |
| data/operations/sign      | Значение card_operations.sign                                                                                                                                                                                          |
| data/operations/amount    | Значение card_operations.amount                                                                                                                                                                                        |
| data/operations/currency  | Значение card_operations.currency – ‘₽’, если получено значение ‘RUB </br>Значение card_operations.currency – ‘$’, если получено значение ‘USD’ <\br>Значение card_operations.currency – ‘€’, если получено значение ‘EUR’ |
| data/operations/place     | Если значение card_operations.place                                                                                                                                                                                    |
| data/operations/icon      | Значение card_operations.icon                                                                                                                                                                                          |
| data/operations/oper_type | Значение card_operations.oper_type                                                                                                                                                                                     |

5. Сервис возвращает ответ вызывающей системе.

## Исключительные сценарии (EC)

### ЕС-1. Отсутствуют операции по карте
1. Сервис формирует ответ, согласно маппингу.

|Параметр ответа|Правило формирования|
|---------------|--------------------|
|data/error/code|Код ошибки|
|data/error/text|«Операции по карте за указанный период отсутствуют»|

