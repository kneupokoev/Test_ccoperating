# API_Получение истории операций по карте
## История изменений
| Автор       | Версия изменений | Описание                  | Задача |
|-------------|------------------|---------------------------|--------|
| Грицук М.В. | 1.0              | Исходная версия документа | TASK-1 |

**Цель:** сервис предназначен для получения истории операций по карте клиента.

**URL:** [endpoint]/api/cards/{cardId}/operations/list

**Метод:**  GET

**Доступ:** авторизованная зона. Сервис вызывается с фронта. Клиент перешел к выбранной карте.

**Входные параметры:**

| Параметр    | Тип поля | Описание                                                                | Обязательность |
|-------------|----------|-------------------------------------------------------------------------|----------------|
| cardId      | number   | id карты, для которой нужно получить историю операций                   | Да             |
| begindate   | date     | Дата начала периода, за который нужно получить историю операций         | Да             |
| enddate     | date     | Дата окончания периода, за который нужно получить историю операций      | Да             |
| numberOfOps | number   | Максимальное количество операций, которое нужно вернуть в ответ         | Нет            |
| status      | string   | Статусы операций, по которым нужно получить историю                     | Да             |

**Выходные параметры:**

| Параметр                                       | Тип поля     | Описание                         | Обязательность |
|------------------------------------------------|--------------|----------------------------------|----------------|
| data/cards/{cardId}/operations                 | List[Object] | Список операций                  | Нет            |
| data/cards/{cardId}/operations/operationDesign | String       | Иконка (url)                     | Нет            |
| data/cards/{cardId}/operations/dateTime        | Datetime     | Дата и время совершения операции | Да             |
| data/cards/{cardId}/operations/merchant        | String       | Мерчант                          | Да             |
| data/cards/{cardId}/operations/category        | String       | Категория операции               | Да             |
| data/cards/{cardId}/operations/amount          | Decimal      | Сумма операции                   | Да             |
| data/cards/{cardId}/operations/currency        | String       | Валюта операции                  | Да             |

## **Основной сценарий (MC)**

1. Сервис инициирует получение списка операций по карте клиента из Cards, формируя запрос:

| Атрибут | Описание                                |
|---------|-----------------------------------------|
| cardId  | Значение backSystemId для текущей карты |

2. После получения ответа от бэк-системы, выполняется проверка, получена ли информация об операциях по карте:
   2.1. Если получен пустой ответ, ошибка или таймаут, то переход к сценарию ЕС-1

3. Сервис формирует ответ согласно маппингу:

| Параметр ответа                                | Правило формирования (поле в ответе Cards)  |
|:-----------------------------------------------|:--------------------------------------------|
| card_id_ext                                    | Значение cardid3c в ответе Cards            |
| card_id                                        | Текущий ИД карты в ДБО                      |
| data/cards/{cardId}/operations                 | -                                           |
| data/cards/{cardId}/operations/operationDesign | Значение  operation_design в  ответе Cards  |
| data/cards/{cardId}/operations/dateTime        | Значение  transaction_date  в  ответе Cards |
| data/cards/{cardId}/operations/merchant        | Значение place в ответе Cards               |
| data/cards/{cardId}/operations/category        | Значение mcc в ответе Cards                 |
| data/cards/{cardId}/operations/amount          | Значение auth_amount в ответе Cards         |
| data/cards/{cardId}/operations/currency        | Значение  auth_currency  в  ответе Cards    |

4. Сервис возвращает ответ вызывающей системе.
## Исключительные сценарии (EC)
**ЕС-1. У клиента нет операций по карте**
1. Сервис формирует ответ, согласно маппингу.

| Параметр ответа | Правило формирования                                |
|:----------------|:----------------------------------------------------|
| data/error/code | Код ошибки                                          |
| data/error/text | “Отсутствуют операции по карте за выбранный период” |

3. API возвращает ответ.
## Конфигурационные параметры

| Название конфига | Описание | Значение |
|:-----------------|:---------|:---------|
|                  |          |          |