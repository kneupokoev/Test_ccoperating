# Frontend_Список карт и детали по карте
**Цель:**  документ описывает раздел «Список карт», и дополнительные формы, входящие в раздел.
## История изменений
| Автор         | Дата изменения | Версия изменений | Описание                                    | Задача |
|:--------------|:---------------|:-----------------|:--------------------------------------------|:-------|
| Малышева Н.С. | 15.09.2021     | 1.0              | Исходная версия документа                   | TASK-1 |
| Грицук М.В.   | 04.05.2022     | 1.1              | Добавлено описание блока “История операций” | TASK-2 |

## **Ссылка на дизайн**
## **Общие требования к разделу**
Раздел доступен всем клиентам ДБО. Раздел открывается сразу после входа в ДБО и является частью «Главного экрана».
### Макет раздела
![](/Users/gritsuk_mari/IdeaProjects/Test_ccoperating/Documentation/Функциональные требования/Раздел.png)
![](/Users/gritsuk_mari/IdeaProjects/Test_ccoperating/Documentation/Функциональные требования/Карты.png)
![](/Users/gritsuk_mari/IdeaProjects/Test_ccoperating/Documentation/Функциональные требования/История операций.png)

## Блок «Карты»
Для отображения раздела Frontend инициирует вызов сервиса GET api/cards/list (запрос не параметризован)

В случае если от сервиса получена ошибка или пустой ответ, отображается экран с ошибкой. Текст сообщения «Что-то пошло не так, но мы уже знаем о проблеме…»

В случае если получен успешный ответ, Frontend отображает форму с параметрами:

| Поле              | Описание                                                                                                                                                                                                                         |
|:------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Блок с картами    | Содержит экземпляры data/cards[] ответа сервиса GET api/cards/list                                                                                                                                                               |
| Элемент Карта     |                                                                                                                                                                                                                                  |
| Иконка            | Значение  data/cards/cardDesign<br/>Если значение не получено, отображается иконка по умолчанию                                                                                                                                  |
| Название карты    | Значение data/cards/name<br>В поле отображается 100 символов. Если значение больше, то отображается только часть текста и троеточие.<br>При наведении на такую строку полный текст должен отображаться во всплывающей подсказке. |
| Платежная система | Значение data/cards/paySystem                                                                                                                                                                                                    |
| Номер карты       | Значение data/cards/maskedNumber<br>Отображается в формате *XXXX, где XXXX - последние 4 цифры значения                                                                                                                          |
| Тип карты         | Значение data/cards/cardtype<br>В случае если получено значение:<ul><li>‘debit’ отобразить текст «Дебетовая»‘</li><li>credit’ отобразить текст «Кредитная»</li></ul>                                                             |
| Баланс            | Значение data/cards/balance<br>По-умолчанию отображается зеленым цветом<br>В случае если значение отрицательное - отображается красным цветом                                                                                    |
| Статус карты      | Если получено значение data/cards/status:<ul><li>‘active’ - отобразить значение «Активна»</li><li>‘blocked’- отобразить значение «Заблокирована»</li><li>‘inactive’ - отобразить значение «Требует активации»</li></ul>          |

Под каждой картой отображаются действия, доступные с картой:

| Действие         | Описание                                                                                                                                                                                                                       |
|:-----------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Реквизиты        | tbd                                                                                                                                                                                                                            |
| Тарифы           | tbd                                                                                                                                                                                                                            |
| Заблокировать    | tbd                                                                                                                                                                                                                            |
| История операций | см. Раздел История операций<br><br>Элемент представлен ссылкой.<br><br>По нажатию на ссылку появляется раскрывающийся вниз блок<br><br>Заголовок блока меняется в зависимости от раскрытия: «Показать/Скрыть историю операций» |

# История операций
Для отображения раздела Frontend инициирует вызов сервиса GET api/cards/{cardId}/operations, при этом передается:

* cardId == id карты, из которой перешли к текущей форме
* begindate == значение текущей даты минус 10 дней
* enddate == значение текущей даты
* numberOfOps == 5 (число операций, которое необходимо вернуть)
* status = “success”

В случае если от сервиса получена ошибка, отображается экран с ошибкой. Текст сообщения «Что-то пошло не так, но мы уже знаем о проблеме…»

В случае если от сервиса получен пустой список операций, отображается экран с текстом сообщения “Операции по карте отсутствуют.”

Каждый элемент списка истории операций представлен следующим набором элементов:

| Поле                             | Описание                                                                                                                                                                                                                    |
|:---------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Список операций                  | Содержит  экземпляры data/cards/{cardId}/operations/[] ответа  сервиса GET api/cards/{cardId}/operations/list                                                                                                               |
| Элемент списка операций          |                                                                                                                                                                                                                             |
| Иконка                           | Значение data/cards/{cardId}/operations/operationDesign  Если значение не получено, отображается иконка по умолчанию                                                                                                        |
| Дата и время совершения операции | Значение data/cards/{cardId}/operations/dateTime                                                                                                                                                                            |
| Название мерчанта                | Значение data/cards/{cardId}/operations/merchant                                                                                                                                                                            |
| Категория операции               | Значение data/cards/{cardId}/operations/category                                                                                                                                                                            |
| Сумма  и валюта операции         | Составное значение: {amount} + “ ” + {currency}, где:<ul><li>amount - значение data/cards/{cardId}/operations/amount в  формате "ХХХХХХ  ХХХ"</li><li>currency – значение data/cards/{cardId}/operations/currency</li></ul> |

Операции группируются по датам.

Под списком операций отображается кнопка "Показать полную историю". При нажатии:
1. Происходит повторный вызов сервиса GET api/cards/{cardId}/operations, при этом передается:
* cardId == id карты, из которой перешли к текущей форме.
* begindate == значение первого дня текущего месяца
* enddate == значение текущей даты
* status = “success”
2. Отображается список операций за текущий месяц без ограничения на количество элементов и кнопка “Выбрать период” с возможностью выбора периода, за который нужно отобразить полную историю.
   При нажатии на кнопку “Выбрать период” отображается:
* календарь, где пользователь выбирает начальную и конечную даты периода.
* кнопка “Закрыть” – при нажатии окно выбора дат закрывается
* кнопка “Готово” – при нажатии происходит повторный вызов сервиса GET api/cards/{cardId}/operations, при этом передается:
    * cardId == id карты, из которой перешли к текущей форме.
    * begindate == выбранная дата начала периода
    * enddate ==  выбранная дата окончания периода
    * status = “success”
3. Отображается список операций за выбранный период без ограничения на количество элементов и кнопка “Выбрать период” с возможностью корректировки выбранного периода.
