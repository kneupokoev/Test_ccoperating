## **Frontend\_Список карт и детали по карте**

**Цель:** документ описывает раздел «Список карт», и дополнительные формы, входящие в раздел.

### **История изменений**

|**Автор**|**Дата изменения**|**Версия изменений**|**Описание**|**Задача**|
| :- | :- | :- | :- | :- |
|Малышева Н.С.|15.09.2021 |1.0|Исходная версия документа|TASK-1|
|Евсеева В.А.|19.04.2022|1.1|<p>- Доработаны макеты</p><p>- Добавлена ссылка на макет в figma</p><p>- Изменено описание элемента блока Карты: История операций</p><p>- Добавлено описание раздела История операций</p>||
### **Ссылка на дизайн**

[Макеты figma](https://www.figma.com/file/N5qDmSkGw5VrlDDFiYcf4q/Untitled?node-id=0:1) 

### **Общие требования к разделу**

Раздел доступен всем клиентам ДБО. Раздел открывается сразу после входа в ДБО и является частью «Главного экрана».

**Макет раздела**

` `![](Maket.png)

### **Блок «Карты»**

Для отображения раздела Frontend инициирует вызов сервиса GET api/cards/list (запрос не параметризован)

В случае если от сервиса получена ошибка или пустой ответ, отображается экран с ошибкой. Текст сообщения «Что-то пошло не так, но мы уже знаем о проблеме…»

В случае если получен успешный ответ, Frontend отображает форму с параметрами:

|**Поле**|**Описание**|
| :- | :- |
|Блок с картами|Содержит экземпляры data/cards[] ответа сервиса GET api/cards/list|
|Элемент Карта| |
|`|`Иконка|<p>Значение data/cards/cardDesign</p><p>Если значение не получено, отображается иконка по-умолчанию</p>|
|`|`Название карты|<p>Значение data/cards/name</p><p>В поле отображается 100 символов. Если значение больше, то отображается только часть текста и троеточие.</p><p>При наведении на такую строку полный текст должен отображаться во всплывающей подсказке.</p>|
|`|`Платежная система|Значение data/cards/paySystem|
|`|`Номер карты|<p>Значение data/cards/maskedNumber</p><p>Отображается в формате \*XXXX, где XXXX - последние 4 цифры значения</p>|
|`|`Тип карты|<p>Значение data/cards/cardtype</p><p>В случае если получено значение</p><p>- ‘debit’ отобразить текст «Дебетовая»</p><p>- ‘credit’ отобразить текст «Кредитная»</p>|
|`|`Баланс|<p>Значение data/cards/balance</p><p>По-умолчанию отображается зеленым цветом</p><p>В случае если значение отрицательное - отображается красным цветом</p>|
|`|`Статус карты|<p>Если получено значение data/cards/status:</p><p>- ‘active’ - отобразить значение «Активна»</p><p>- ‘blocked’- отобразить значение «Заблокирована»</p><p>- ‘inactive’ - отобразить значение «Требует активации»</p>|

Под каждой картой отображаются действия, доступные с картой:

|**Действие**|**Описание**|
| :- | :- |
|Реквизиты|tbd|
|Тарифы|tbd|
|Заблокировать|tbd|
|История операций|<p>см. Раздел История операций</p><p>Элемент представлен ссылкой “Показать историю операций” и кнопкой “Все операции”.</p><p>- По нажатию на ссылку появляется раскрывающийся вниз блок<br>  Заголовок блока меняется в зависимости от раскрытия: «Показать/Скрыть историю операций»</p><p>- По нажатию кнопки “Все операции” открывается экран “История операций” на месте блока Карты.</p>|

### **«История операций»**
#### **Отображение краткой истории операций.**
Пользователь нажимает ссылку “Показать историю операций” в блоке Карты, Frontend инициирует вызов сервиса POST api/{card\_id}/operations (описание сервиса в документе **API\_Получение истории операций по карте**).

В списке **краткой истории** отображаются операции за последние 10 дней, но не больше чем 5 операций. Параметры запроса заполняются в соответствии с таблицей:

|**Параметр**|**Значение**|
| :- | :- |
|filter/startDate |Текущая дата минус 10 дней|
|filter/endDate|Текущая дата|
|count|5|
|page|0|
В случае, если от сервиса получена ошибка, отображается экран с ошибкой: «Что-то пошло не так, но мы уже знаем о проблеме…»

В случае, если от сервиса получен пустой ответ, отображается сообщение: “Список операций пуст”.

В случае, если получен успешный непустой ответ, Frontend отображает раскрывающийся блок со списком операций под блоком Карта с параметрами:


|**Поле** |**Описание**|
| :- | :- |
|**Блок с операциями**|Содержит экземпляры operations[] ответа сервиса POST /api/{card\_id}/operations|
|Элемент Операция||
|`|`Иконка операции/мерчанта|Заполняется иконкой из ответа POST /api/{card\_id}/operations в параметре operations/mcc/icon|
|`|`Название операции/название мерчанта|Заполняется значением параметра operations/merchantName ответа POST /api/{card\_id}/operations|
|`|`Сумма и валюта операции|Заполняется значением параметров operations/amount и operations/currency ответа POST /api/{card\_id}/operations (через пробел)|
|`|`Категория операции|Заполняется значением параметра operations/mcc/name ответа POST /api/{card\_id}/operations|
|`|`Время совершения операции|Заполняется значением параметра operations/operDate ответа POST /api/{card\_id}/operations без учета даты.|

Операции сгруппированы по дате operations/operDate ответа /api/{card\_id}/operations (без учета времени).


#### **Отображение полной истории операций.**


Пользователь нажимает кнопке  “Все операции” в блоке Карты, Frontend инициирует вызов сервиса POST api/{card\_id}/operations (описание сервиса в документе **API\_Получение истории операций по карте**).

Frontend инициирует вызов сервиса GET api/operations/mccData (описание сервиса в документе **API\_Получение кодов mcc**).

В списке **полной истории операций** отображаются операций сгруппированы по дате operations/operDate ответа /api/{card\_id}/operations (без учета времени)..

Параметры запроса заполняются в соответствии с таблицей:

|**Параметр**|**Значение**|
| :- | :- |
|filter/startDate |Первые день текущего месяца|
|filter/endDate|Текущая дата|
|count|25|
|page|0|
В случае, если от сервиса получена ошибка, отображается экран с ошибкой: «Что-то пошло не так, но мы уже знаем о проблеме…»

В случае, если от сервиса получен пустой ответ, отображается сообщение: “Список операций пуст”.

В случае, если получен успешный непустой ответ, Frontend отображает блок История операций на месте блока со списком карт. 

Параметры блока История операций:


|**Поле** |**Описание**|
| :- | :- |
|**Плашка заголовка**|-|
|Иконка Закрыть|По нажатию блок закрывается и осуществляется возврат в блок карты.|
|Заголовок |“Все операции”|
|Платежная система|Значение data/cards/paySystem|
|Номер карты|<p>Значение data/cards/maskedNumber</p><p>Отображается в формате \*XXXX, где XXXX - последние 4 цифры значения</p>|
|**Блок Фильтров**|-|
|Тип операции|<p>Поле с выпадающим списком. По умолчанию выбрано значение “Все операции”.<br>Возможные значения:<br>“Оплата услуг в ИБ”<br>“POS”<br>“Операции с наличными(ATM)”<br>“Платный запрос баланса карты”<br>“P2P”<br>“Комиссия”</p><p>“Операции с наличными (KAS)”</p><p>“Перевод по счету”</p><p>Пользователь может выбрать несколько значений.</p><p>Для подтверждения выбора в конце списка отображается кнопка “Подтвердить”.<br>При нажатии “Подтвердить” заполняется параметр filter/operType запроса /api/{card\_id}/operations </p>|
|Категория|<p>Поле с выпадающим списком. По умолчанию выбрано “Все категории”.</p><p>Для отображения значений в выпадающем списке используется значение параметра mccList/name ответа сервиса api/operations/mccData.</p><p>Пользователь может выбрать несколько значений.</p><p>Для подтверждения выбора в конце списка отображается кнопка “Подтвердить”.<br>При нажатии “Подтвердить” заполняется параметр filter/mccCode запроса /api/{card\_id}/operations значением кода code из ответа api/operations/mccData.</p>|
|Период с|Поле для ввода даты начала периода запрашиваемой истории.<br>По умолчанию заполнено датой первого дня месяца.<br>При смене пользователем значения - заполняется параметр filter/startDate запроса /api/{card\_id}/operations |
|Период по|<p>Поле для ввода даты окончания периода запрашиваемой истории.</p><p>По умолчанию заполнено текущей датой.<br>При смене пользователем значения - заполняется параметр filter/endDate запроса /api/{card\_id}/operations</p>|
|Сортировка|<p>Выпадающий список.<br>Возможные значения:<br>“Сначала новые операции”<br>“Сначала старые операции”<br>“По сумме от большего к меньшему”<br>“По сумме от меньшего к большему”</p><p>По умолчанию выбрано “Сначала новые”.</p><p>При смене пользователем значения - заполняется параметр sort/ запроса /api/{card\_id}/operations в соответствии с маппингом:<br>“Сначала новые операции”: sort/lastFirst=true<br>“Сначала старые операции”: sort/lastFirst=false<br>“По сумме от большего к меньшему”: sumDesc=true</p><p>“По сумме от меньшего к большему”: sumDesc=false</p>|
|**Блок с операциями**|Содержит экземпляры operations[] ответа сервиса POST /api/{card\_id}/operations|
|Элемент Операция||
|`|`Иконка операции|Заполняется иконкой из ответа POST /api/{card\_id}/operations в параметре operations/mcc/icon|
|`|`Название операции/ мерчанта|Заполняется значением параметра operations/merchantName ответа POST /api/{card\_id}/operations|
|`|`Сумма и валюта операции|Заполняется значением параметров operations/amount и operations/currency ответа POST /api/{card\_id}/operations (через пробел)|
|`|`Категория операции|Заполняется значением параметра operations/mcc/name ответа POST /api/{card\_id}/operations|
|`|`Время совершения операции|Заполняется значением параметра operations/operDate ответа POST /api/{card\_id}/operations без учета даты.|
|Кнопка “Загрузить еще”|По кнопке отправляется запрос POST /api/{card\_id}/operations с инкрементированным значением параметра page.|